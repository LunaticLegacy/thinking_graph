<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title data-i18n="appTitle">Thinking Graph</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="backdrop" aria-hidden="true"></div>
    <header class="topbar fade-in">
        <div>
            <p class="eyebrow" data-i18n="header.title">Thinking Graph</p>
            <h1 data-i18n="header.subtitle">观点节点关系图</h1>
        </div>
        <button id="refresh-all" class="btn btn-secondary" data-i18n="header.refresh">刷新</button>
    </header>

    <main class="layout">
        <section class="panel fade-in delay-1">
            <h2 data-i18n="nodePanel.title">新增观点节点</h2>
            <form id="node-form" class="stacked-form">
                <label>
                    <span data-i18n="nodePanel.contentLabel">观点内容</span>
                    <textarea id="node-content" required data-i18n-placeholder="nodePanel.contentPlaceholder" placeholder="例如：远程办公可以提升深度工作效率"></textarea>
                </label>
                <label>
                    <span data-i18n="nodePanel.summaryLabel">简短摘要</span>
                    <input id="node-summary" type="text" data-i18n-placeholder="nodePanel.summaryPlaceholder" placeholder="例如：远程办公提升效率">
                </label>
                <div class="dual-field-row">
                    <label>
                        <span data-i18n="nodePanel.confidenceLabel">置信度 (0~1)</span>
                        <input id="node-confidence" type="number" min="0" max="1" step="0.1" value="1">
                    </label>
                    <label>
                        <span data-i18n="nodePanel.colorLabel">节点颜色</span>
                        <input id="node-color" type="color" value="#157f83">
                    </label>
                </div>
                <button type="submit" class="btn" data-i18n="nodePanel.createBtn">创建节点</button>
                <p id="node-form-mode" data-i18n="nodePanel.updateHint">点击画布空白处可创建节点；选中节点后，提交表单会更新该节点属性。</p>
            </form>

            <h2 data-i18n="connectionPanel.title">创建连接</h2>
            <form id="connection-form" class="stacked-form">
                <label>
                    <span data-i18n="connectionPanel.sourceLabel">起点观点</span>
                    <select id="source-node" required></select>
                </label>
                <label>
                    <span data-i18n="connectionPanel.targetLabel">终点观点</span>
                    <select id="target-node" required></select>
                </label>
                <label>
                    <span data-i18n="connectionPanel.typeLabel">关系类型</span>
                    <select id="conn-type">
                        <option value="supports" data-i18n="connectionPanel.types.supports">supports</option>
                        <option value="opposes" data-i18n="connectionPanel.types.opposes">opposes</option>
                        <option value="relates" data-i18n="connectionPanel.types.relates">relates</option>
                        <option value="leads_to" data-i18n="connectionPanel.types.leads_to">leads_to</option>
                        <option value="derives_from" data-i18n="connectionPanel.types.derives_from">derives_from</option>
                    </select>
                </label>
                <label>
                    <span data-i18n="connectionPanel.descriptionLabel">关系描述</span>
                    <input id="conn-description" type="text" data-i18n-placeholder="connectionPanel.descriptionPlaceholder" placeholder="例如：A 作为 B 的前提条件">
                </label>
                <button type="submit" class="btn" data-i18n="connectionPanel.createBtn">创建连接</button>
            </form>

            <div class="stack-inline">
                <button id="delete-node" class="btn btn-danger" data-i18n="actionButtons.deleteNode">删除选中节点</button>
                <button id="delete-connection" class="btn btn-danger" data-i18n="actionButtons.deleteConnection">删除选中连接</button>
                <button id="update-node-color" class="btn btn-secondary" data-i18n="actionButtons.updateColor">更新选中节点颜色</button>
                <button id="tidy-graph" class="btn btn-secondary" data-i18n="actionButtons.tidyGraph">一键整理布局</button>
            </div>

            <h2 data-i18n="saveLoadPanel.title">保存/加载思考图</h2>
            <form id="graph-save-form" class="stacked-form">
                <label>
                    <span data-i18n="saveLoadPanel.nameLabel">快照名称</span>
                    <input id="save-graph-name" type="text" data-i18n-placeholder="saveLoadPanel.namePlaceholder" placeholder="例如：讨论版本-v1" required>
                </label>
                <button type="submit" class="btn btn-secondary" data-i18n="saveLoadPanel.saveBtn">保存当前图</button>
            </form>
            <div class="stack-inline">
                <select id="saved-graphs"></select>
                <button id="load-graph" type="button" class="btn btn-secondary" data-i18n="saveLoadPanel.loadBtn">加载选中图</button>
                <button id="refresh-saved" type="button" class="btn btn-secondary" data-i18n="saveLoadPanel.refreshListBtn">刷新列表</button>
                <button id="delete-saved-graph" type="button" class="btn btn-danger" data-i18n="saveLoadPanel.deleteBtn">删除已保存图</button>
                <button id="clear-graph" type="button" class="btn btn-danger" data-i18n="saveLoadPanel.clearBtn">清空当前图</button>
            </div>
            <div class="stack-inline">
                <button id="export-graph" type="button" class="btn btn-secondary" data-i18n="saveLoadPanel.exportJson">Export JSON</button>
                <button id="import-graph" type="button" class="btn btn-secondary" data-i18n="saveLoadPanel.importJson">Import JSON</button>
                <input id="import-graph-file" type="file" accept=".json,application/json" hidden>
            </div>
        </section>

        <section class="panel canvas-panel fade-in delay-2">
            <div class="canvas-head">
                <h2 data-i18n="nodePanel.blankCanvasHint">关系图</h2>
                <p id="selection-tip">点击空白创建节点；点击节点可编辑属性</p>
            </div>
            <div id="network"></div>
        </section>

        <section class="panel fade-in delay-3">
            <h2 data-i18n="auditPanel.title">审计状态</h2>
            <div class="stack-inline">
                <button id="verify-audit" class="btn btn-secondary" data-i18n="auditPanel.verifyBtn">审计完整性检查</button>
                <span id="audit-status" class="badge">未检查</span>
            </div>
            <ul id="audit-issues" class="issues"></ul>

            <h2 data-i18n="auditPanel.historyTitle">最近审计记录</h2>
            <ul id="audit-list" class="audit-list"></ul>

            <h2 data-i18n="auditPanel.llmTitle">LLM 入口</h2>
            <div class="stack-inline">
                <button id="llm-review-graph" type="button" class="btn btn-secondary" data-i18n="auditPanel.reviewBtn">一键审核思考图有效性</button>
            </div>
            <pre id="llm-review-response" class="llm-output" data-i18n="auditPanel.waitingReview">等待审核...</pre>

            <form id="llm-generate-form" class="stacked-form">
                <label>
                    <span data-i18n="auditPanel.topicLabel">Topic</span>
                    <textarea id="llm-generate-topic" required data-i18n-placeholder="auditPanel.generatePlaceholder" placeholder="输入主题，让 LLM 生成思考图并覆盖当前图"></textarea>
                </label>
                <button type="submit" class="btn btn-secondary" data-i18n="auditPanel.generateBtn">生成并覆盖当前图</button>
            </form>
            <pre id="llm-generate-response" class="llm-output" data-i18n="auditPanel.waitingGenerate">等待生成...</pre>

            <form id="llm-form" class="stacked-form">
                <label>
                    <span data-i18n="auditPanel.promptLabel">Prompt</span>
                    <textarea id="llm-prompt" required data-i18n-placeholder="auditPanel.promptPlaceholder" placeholder="让 LLM 帮我拆分该主题的关键观点与冲突关系"></textarea>
                </label>
                <button type="submit" class="btn">调用 LLM</button>
            </form>
            <pre id="llm-response" class="llm-output" data-i18n="auditPanel.waitingCall">等待调用...</pre>
        </section>
    </main>

    <!-- 引入国际化脚本 -->
    <script src="{{ url_for('static', filename='i18n.js') }}"></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>